!function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var o={};e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(module,exports){!function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var o={};e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(7),n=function(){function t(){}return t.getTagData=function(){var t;try{t=document.currentScript,t.getAttribute("data-siteKey")&&t.getAttribute("data-pubKey")||(t=document.getElementById("browsi-tag"))}catch(e){t=document.getElementById("browsi-tag")}if(!t)throw new Error("no tag");var e=sessionStorage.__browsienv||t.getAttribute("data-browsidomain")||".browsiprod.com";return{tag:t,sk:t.getAttribute("data-siteKey")||"error",pk:t.getAttribute("data-pubKey")||"error",ds:e,y:"yield-manager"+e,es:"//events"+e+"/events/"}},t.getD=function(){var t=sessionStorage.getItem("__brwsidbg"),e={};return t&&(e=JSON.parse(t)),e},t.isD=function(){var e=t.getD();return!(!e||!e.hasOwnProperty("debug"))},t.isObject=function(t){return t&&"object"==typeof t&&!Array.isArray(t)},t.mergeDeep=function(t,e){if(this.isObject(t)&&this.isObject(e))for(var o in e)e.hasOwnProperty(o)&&this.isObject(e[o])?(t[o]||Object.assign(t,(i={},i[o]={},i)),this.mergeDeep(t[o],e[o])):Object.assign(t,(n={},n[o]=e[o],n));return t;var i,n},t.generateToken=function(){var t="abcdefghijklmnopqrstuvwxyz";t+=t.toUpperCase()+"_";for(var e="",o=0;o<10;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},t.getCookie=function(t){var e=(this.getTopDocument()||document).cookie.split(/\s*;\s*/).map(function(t){var e=t.split(/\s*=\s*/);if(e&&2===e.length)return{key:e[0],value:e[1]}}).find(function(e){return e&&e.key===t});return e?e.value:""},t.setCookie=function(t,e,o,i){var n=6e4;"d"===i&&(n*=1440);var r=new Date(+new Date+o*n);(this.getTopDocument()||document).cookie=t+"="+e+"; expires="+r.toUTCString()+"; path=/"},t.setLocalStorage=function(t,e){try{localStorage.setItem(t,e)}catch(t){}},t.getLocalStorage=function(e){try{return(t.getTopWindow()||window).localStorage.getItem(e)||""}catch(t){}return""},t.toUrlParams=function(t){return Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")},t.getHead=function(t){return t.head||t.getElementsByTagName("head")[0]},t.clone=function(t){return JSON.parse(JSON.stringify(t))},t.getTopWindow=function(){try{return window.top.document,window.top}catch(t){return null}},t.getTopDocument=function(){try{return window.top.document}catch(t){return null}},t.getResolution=function(){var t=this.getTopWindow()||window;return t.screen.width+"x"+t.screen.height},t.findDomPosition=function(e){for(var o=e,n=window!==t.getTopWindow();o;)switch(o.tagName){case"HEAD":return n?i.DomPosition.IHead:i.DomPosition.Head;case"BODY":return n?i.DomPosition.IBody:i.DomPosition.Body;default:o=o.parentElement}return i.DomPosition.NA},t.getWindow=function(){var e=t.getTopWindow();return null===e?window:e},t.isPositionContained=function(t,e){return!!(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)},t.isDesktopResponse=function(t){return t&&t.dt&&t.dt.p&&"DESKTOP"===t.dt.p},t}();e.default=n},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,n=o(0);!function(t){t.INFO="info",t.ERROR="error",t.CUSTOM="custom",t.DEBUG="debug"}(i=e.LogTypes||(e.LogTypes={}));var r=function(){function t(t){this.className=t,this.isActive=!!n.default.getD().debug}return t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logMessage(i.INFO,t)},t.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logMessage(i.DEBUG,t)},t.prototype.custom=function(t,e){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];var r=[{msg:t,style:e,args:o}];this.logMessage(i.CUSTOM,r)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logMessage(i.ERROR,t)},t.prototype.logMessage=function(t,e){this.isActive&&(t!==i.CUSTOM?console[t].apply(console,["["+this.className+"]"].concat(e)):console.info("%c["+this.className+"] "+e[0].msg,e[0].style,e[0].args))},t}();e.Logger=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(0),n=o(1),r=o(3),s=function(){function t(){this.tagData=i.default.getTagData(),this.eventsHost=this.tagData.es,this.logger=new n.Logger("Events")}return t.get=function(){return t._instance||(this._instance=new t),t._instance},t.prototype.getStaticFields=function(){if(!this.staticFields&&this.loaderParams){var t=window.top.document;this.staticFields=Object.assign({},this.buildStaticData(),{r:document.referrer.toLowerCase(),url:encodeURIComponent(t.location.protocol+"//"+t.location.host+t.location.pathname),res:window.top.screen.width+"x"+window.top.screen.height})}return this.staticFields},t.prototype.buildStaticData=function(){var t;switch(this.loaderParams.type){case"mobile":return t=this.loaderParams.deviceType||{},{sk:this.loaderParams.siteKey,pk:this.loaderParams.publisherKey,pvid:this.loaderParams.pageViewID,bpid:this.loaderParams.bootstrapPageViewId,aid:this.loaderParams.articleId,sid:this.loaderParams.sessionID,uid:this.loaderParams.userID,scid:this.loaderParams.supplyConfigId,db:t.browser||"",dbt:t.browserType||"",d:t.vendor+" "+t.model,dp:t.devicePlatform||"",dv:t.vendor||"",dos:t.os||"",dosv:t.osVersion||"",ibpv:this.loaderParams.isBenchmarked,geo:this.loaderParams.country_code,ts:this.loaderParams.trafficSource,mv:this.loaderParams.version,iru:this.loaderParams.isReturningUser};case"desktop":return t=this.loaderParams.dt||{},{sk:this.loaderParams.i.sk,pk:this.loaderParams.i.pk,pvid:this.loaderParams.i.pv,bpid:this.loaderParams.bpvi,aid:this.loaderParams.i.aid,sid:this.loaderParams.i.s,uid:this.loaderParams.i.u,scid:this.loaderParams.i.sc,db:t.b||"",dbt:t.bt||"",d:t.d||"",dp:t.p||"",dv:t.v||"",dos:t.os||"",dosv:t.osv||"",ibpv:this.loaderParams.r.b,geo:this.loaderParams.r.cc,ts:this.loaderParams.r.ts,mv:this.loaderParams.e.v,iru:this.loaderParams.r.ru};default:return{sk:"",pk:"",pvid:"",bpid:"",aid:"",sid:"",uid:"",scid:"",db:"",dbt:"",d:"",dp:"",dv:"",dos:"",dosv:"",ibpv:!1,geo:"",ts:"",mv:"",iru:!1}}},t.prototype.sendInitialHit=function(t,e){var o={now:Math.floor(Date.now()/1e3),et:"initial_hit",to:+new Date-e,url:encodeURIComponent(t.url),res:i.default.getResolution(),uid:t.uid,sk:t.sk,pk:t.pk,r:t.r,sid:t.sid,bpvid:t.bpvid,ua:window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"",tp:i.default.findDomPosition(this.tagData.tag),ta:null!==i.default.getTopWindow(),mv:t.mv};this.send(o,"supply",o.et,o.bpvid)},t.prototype.sendPapRequestEvent=function(t,e,o,i,n,r,s,a,d,u){var p=Object.assign({},this.getStaticFields(),{now:Math.floor(Date.now()/1e3),et:"pap_request",to:+new Date-d,plid:t,au:e,isa:n,ibl:r,rs:a,pv:u,praw:s,rc:o},{},i?{p:"NA"!=i?Number(i):-1}:{});this.send(p,"demand",p.et,this.staticData.pvid)},t.prototype.sendPapMatchedEvent=function(t,e,o,i,n,r,s,a){var d=Object.assign({},this.getStaticFields(),{now:Math.floor(Date.now()/1e3),et:"pap_matched",to:+new Date-r,plid:t,au:e,w:i.w,h:i.h,im:o,rc:s,pv:a},n?{p:"NA"!=n?Number(n):-1}:{});this.send(d,"demand",d.et,this.staticData.pvid)},t.prototype.send=function(t,e,o,n){var s=new XMLHttpRequest;if(s.open("POST",""+this.eventsHost+e+"?p="+n,!0),s.send(JSON.stringify([t])),this.logger.custom(e+"/"+o,"background: #AAFF7F; color: black; font-weight: bold; text-decoration:underline; font-size: 18px;",t),i.default.isD()){(r.Output.getValue("firedEvents")||r.Output.setKeyValue("firedEvents",[])).push(t)}},t.prototype.sendError=function(t,e,o,n){var r=window.top.document,s=Object.assign({},{now:Math.floor(Date.now()/1e3),to:+new Date-o,et:"crash",bpid:e.bpvid,sk:e.sk,pk:e.pk,uid:e.uid,sid:e.sid,file:t.filename,lineNo:t.lineno||-1,columnNo:t.colno||-1,msg:t.message+"; "+n,error:t.error,r:e.r,url:encodeURIComponent(r.location.protocol+"//"+r.location.host+r.location.pathname),res:i.default.getResolution(),pvid:"",ibpv:!1,geo:"",ts:"",db:"",dbt:"",d:"",dp:"",dv:"",dos:"",dosv:"",mv:"",iru:!1,scid:""});if(this.loaderParams&&(s=Object.assign(s,"mobile"===this.loaderParams.type?this.getMobileErrorData():this.getDesktopErrorData())),i.default.getD().debug)this.logger.error(s);else{var a=new XMLHttpRequest;a.open("POST",this.tagData.es+"engineError",!0),a.send(JSON.stringify([s]))}},t.prototype.getMobileErrorData=function(){var t=this.loaderParams.deviceType;return{pvid:this.loaderParams.pageViewID,ibpv:this.loaderParams.isBenchmarked,geo:this.loaderParams.country_code,ts:this.loaderParams.trafficSource,db:t.browser,dbt:t.browserType,d:t.vendor+" "+t.model,dp:t.devicePlatform,dv:t.vendor,dos:t.os,dosv:t.osVersion,mv:this.loaderParams.version,iru:this.loaderParams.isReturningUser,scid:this.loaderParams.supplyConfigId}},t.prototype.getDesktopErrorData=function(){var t=this.loaderParams.dt;return{pvid:this.loaderParams.i.pv,ibpv:this.loaderParams.r.b,geo:this.loaderParams.r.cc,ts:this.loaderParams.r.ts,db:t.b,dbt:t.bt,d:t.d,dp:t.p,dv:t.v,dos:t.os,dosv:t.osv,mv:this.loaderParams.e.v,iru:this.loaderParams.r.ru,scid:this.loaderParams.i.sc}},t.prototype.setLoaderParams=function(t){this.loaderParams=t},t.prototype.setStaticData=function(t){this.staticData=t},t}();e.Events=s},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(0),n=function(){function t(){}return t.setKeyValue=function(t,e){return this.validateOutput(),Object.assign((i.default.getTopWindow()||window)[this.bptOut],(o={},o[t]=e,o)),(i.default.getTopWindow()||window)[this.bptOut][t];var o},t.validateOutput=function(){return(i.default.getTopWindow()||window).hasOwnProperty(this.bptOut)||((i.default.getTopWindow()||window)[this.bptOut]={}),(i.default.getTopWindow()||window)[this.bptOut]},t.getValue=function(t){return this.validateOutput()[t]},t.bptOut="bptOut",t}();e.Output=n},function(t,e,o){t.exports=o(5)},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(6),n=o(2),r=o(0),s=o(1),a=o(3);o(9);var d=function(){function t(){this.SESSION_ID_KEY="__browsiSessionID",this.USER_ID_KEY="__browsiUID",this.bootstrapLoadedVariable="browsi_bootstrap_loaded",this.bptVersion="0.135",this.startTime=+new Date,this.tagData=r.default.getTagData(),this.doc=r.default.getTopDocument()||document,this.logger=new s.Logger("app"),this.listenToErrors(),this.debugConfiguration=r.default.getD(),this.staticData=this.buildStaticData(this.debugConfiguration.siteKey),n.Events.get().setStaticData(this.staticData)}return t.prototype.run=function(){var t=this;n.Events.get().sendInitialHit(this.staticData,this.startTime),this.isBootstrapLoaded()||(this.setBootstrapLoaded(),this.waitForPromise(function(){return t.getSupply()}))},t.prototype.setBootstrapLoaded=function(){(r.default.getTopWindow()||window)[this.bootstrapLoadedVariable]=this.staticData.bpvid},t.prototype.getSupply=function(){var t=this;return this.appendGetSupplyScript().then(function(e){var o=t.getPapResponse(e);if(o){var n=t.getKeyValueName(e);new i.PapAgent(o,t.staticData,t.startTime,n).run()}if(e.preEngineUrl?t.executeRule(e):t.getMiddy(e),e.pabp&&!(r.default.getTopWindow()||window).document.getElementById("__bpabh")){var s=t.buildScriptTag(e.pabp);s.id="__bpabh",r.default.getHead((r.default.getTopWindow()||window).document).appendChild(s)}}).catch(function(e){t.logger.error(e)})},t.prototype.getPapResponse=function(t){switch(t.type){case"desktop":return t.p?Object.assign({},t.p,{plidm:t.e.plidm}):null;case"mobile":return t.papResponse?Object.assign({},t.papResponse,{plidm:t.plidm}):null;default:return null}},t.prototype.getKeyValueName=function(t){switch(t.type){case"desktop":return t.e.pkv.p;case"mobile":return t.predictorsKeyValueNames.papaas;default:return"browsiViewability"}},t.prototype.waitForPromise=function(t){if((r.default.getTopWindow()||window).Promise)t();else{this.logger.info("fetching Promise polyfill");var e=this.buildScriptTag("https://middycdn-a.akamaihd.net/tag/promise.js");e.onload=function(){t()},r.default.getHead((r.default.getTopWindow()||window).document).appendChild(e)}},t.prototype.executeRule=function(t){window.top.__browsiLoadFunc=this.getMiddy.bind(this),window.top.__browsiLoadObject=t,r.default.getHead(this.doc).appendChild(this.buildScriptTag(t.preEngineUrl))},t.prototype.buildDesktopLoader=function(t){var e=t&&t.i&&t.i.s,o=t&&t.i&&t.i.u;return t&&(t.i&&(t=Object.assign({},t,{bpvi:this.staticData.pvid,yhn:this.tagData.y,to:this.startTime})),t=Object.assign({},t,{h:t.e&&t.e.h,version:t.e&&t.e.v})),r.default.setCookie(this.SESSION_ID_KEY,e,30,"m"),r.default.setCookie(this.USER_ID_KEY,o,365,"d"),r.default.setLocalStorage(this.USER_ID_KEY,o),t},t.prototype.buildMobileLoader=function(t){var e=t.spotEngineObject,o=t.papResponse,i=t.initResponse,n=i.isReturningUser,s=i.isBenchmarked,a=i.trafficSource,d=i.deviceType,u=i.sessionId,p=i.userId,l=i.pageViewId,c=i.articleId;return r.default.setCookie(this.SESSION_ID_KEY,u,30,"m"),r.default.setCookie(this.USER_ID_KEY,p,365,"d"),r.default.setLocalStorage(this.USER_ID_KEY,p),e=Object.assign({},e,{papResponse:o},{siteKey:this.staticData.sk,publisherKey:t.publisherKey,sessionID:u,userID:p,pageViewID:l,esReportDomain:this.tagData.es,yieldHostname:this.tagData.y,country_code:e.countryCode,yieldOnly:!0,trafficSource:a,isReturningUser:n,isBenchmarked:s,deviceType:d,bootstrapPageViewId:this.staticData.pvid,timeOffset:this.startTime,articleId:c})},t.prototype.isBootstrapLoaded=function(){return!!(r.default.getTopWindow()||window)[this.bootstrapLoadedVariable]},t.prototype.getPreviousBpvid=function(){return(r.default.getTopWindow()||window)[this.bootstrapLoadedVariable]},t.prototype.appendGetSupplyScript=function(){var t=this;return new Promise(function(e,o){var i="__bgscb_"+r.default.generateToken(),s=t.createGetSupplyScriptTag(i,e,o);try{r.default.getHead(t.doc).appendChild(s)}catch(e){n.Events.get().sendError(e,t.staticData,t.startTime,"catch; "+s.src+" bodyExists: "+!!window.top.document.body),t.doc.body&&t.doc.body.appendChild(s)}t.logger.info("getSupply sent")})},t.prototype.createGetSupplyScriptTag=function(t,e,o){var i=this,s=this.buildScriptTag(this.buildGetSupplyUrl(t));return r.default.isD()&&(s.onload=function(){a.Output.setKeyValue("supplyLoaded",!0)},a.Output.setKeyValue("supplyRequest",s)),(r.default.getTopWindow()||window)[t]=function(t,s){if(i.logger.info("getSupply received"),t&&!t.error){r.default.isD()&&a.Output.setKeyValue("supplyResponse",t);var d=r.default.isDesktopResponse(t),u=d?i.buildDesktopLoader(t):i.buildMobileLoader(t);return u.type=d?"desktop":"mobile",i.staticData.pvid=d?u.i.pv:u.pageViewID,r.default.mergeDeep(u,i.debugConfiguration),s&&"object"==typeof s&&s.jsURL&&(u.preEngineUrl=s.jsURL),n.Events.get().setLoaderParams(u),e(u)}return o(t)},s},t.prototype.buildScriptTag=function(t){var e=this,o=document.createElement("script");return o.src=t,o.async=!0,o.setAttribute("crosorigin","anonymous"),o.onerror=function(o){n.Events.get().sendError(o,e.staticData,e.startTime,"onerror "+t)},o},t.prototype.getMiddy=function(t,e){e&&"function"==typeof e.preEngineJS&&(t.externalFlowHandler={preEngine:e.preEngineJS}),window.top._middyo=t;var o=t.middyHost?t.middyHost:"//"+t.h+"/sd/apps/middy/middy"+(t.version?"-":"")+t.version+".js";try{r.default.getHead(this.doc).appendChild(this.buildScriptTag(o))}catch(t){n.Events.get().sendError(t,this.staticData,this.startTime,"catch; "+o+" bodyExists: "+!!window.top.document.body),this.doc.body&&this.doc.body.appendChild(this.buildScriptTag(o))}},t.prototype.getWeightedAvg=function(t,e,o,i){var n=e+i;return n>0?parseFloat(((t*e+o*i)/n).toFixed(2)):0},t.prototype.getAvgOof=function(){var t=JSON.parse(r.default.getLocalStorage("__bus")||"{}");if(t.aof){var e=0,o=0,i=t.aof.sd;for(var n in i)i.hasOwnProperty(n)&&(i[n].arb?o++:i[n].ar&&e++);var s=o/(o+e)||0,a=e+o;return this.getWeightedAvg(t.aof.t_a||0,t.aof.t_i||0,s||0,a)}},t.prototype.buildGetSupplyUrl=function(t){var e=r.default.getTopWindow()||window,o={sk:this.staticData.sk,url:this.staticData.url,bid:this.staticData.bpvid,pw:e.screen&&e.screen.width||-1,c:t,at:this.doc.title||null,sw:e.screen&&e.screen.width||-1,sh:e.screen&&e.screen.height||-1},i=JSON.parse(r.default.getLocalStorage("__bus")||"{}");if(Object.keys(i).length>0){var n={bi:i.bi,bv:i.bv,pi:i.pi,pv:i.pv,b_ativ:i.tiv?this.getWeightedAvg(i.tiv.b_ativ||0,i.tiv.b_ai||0,i.tiv.b_pv_ativ||0,i.tiv.b_pv_ai||0):void 0,aul:i.aul&&i.aul.a||0,uva:i.uv?this.getWeightedAvg(i.uv.t_a||0,i.uv.t_i||0,i.uv.pv_a||0,i.uv.pv_i||0):void 0,uvsp:i.uv?this.getWeightedAvg(i.uv.t_sp||0,i.uv.t_si||0,i.uv.pv_sp||0,i.uv.pv_si||0):void 0,oofu:this.getAvgOof()};Object.keys(n).forEach(function(t){return void 0===n[t]?delete n[t]:""}),Object.assign(o,n)}return this.staticData.r&&(o.r=this.staticData.r),this.staticData.sid&&(o.sid=this.staticData.sid),this.staticData.uid&&(o.uid=this.staticData.uid),r.default.isD()&&a.Output.setKeyValue("supplyParams",o),"//"+this.tagData.y+"/v2/supply?"+r.default.toUrlParams(o)},t.prototype.buildStaticData=function(t){var e=this.isBootstrapLoaded()?this.getPreviousBpvid():r.default.generateToken();return{to:+new Date-this.startTime,sk:t||this.tagData.sk,pk:this.tagData.pk,pvid:e,bpvid:e,r:this.doc.referrer,url:this.doc.location.protocol+"//"+this.doc.location.host+this.doc.location.pathname,sid:r.default.getCookie(this.SESSION_ID_KEY),uid:r.default.getLocalStorage(this.USER_ID_KEY)||r.default.getCookie(this.USER_ID_KEY),mv:this.bptVersion}},t.prototype.listenToErrors=function(){var t=this;r.default.getWindow().addEventListener("error",function(e){var o=e&&e.srcElement&&e.srcElement.src&&"SCRIPT"===e.srcElement.tagName?e.srcElement.src:"";(/.*middy|browsi.*/.test(e.filename)||/.*middy|browsi.*/.test(o))&&n.Events.get().sendError(e,t.staticData,t.startTime,o+","+e.filename)},!0),this.logger.info("listening to errors")},t}();e.mainApp=d,(new d).run()},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Events_1=__webpack_require__(2),Logger_1=__webpack_require__(1),Moat_1=__webpack_require__(8),Utils_1=__webpack_require__(0),PapAgent=function(){function PapAgent(t,e,o,i){this.predictionWindowObjectName="browsiPredictionObject",this.NA="NA",this.injectedSlots=[],this.papResponse=t,this.staticData=e,this.logger=new Logger_1.Logger("PapAgent"),this.startTime=o,this.foundSlots=[],this.listeningToSlotRenderEnded=!1,this.listeningToSlotRequested=!1,this.waitingForApiReady=!1,this.browsiAds=[],this.bootstrapLoadedVariable=window.browsi_bootstrap_loaded,this.predictionKey=i}return PapAgent.prototype.run=function(){this.logger.info("papEngine started"),window.top.browsitag=Object.assign({},window.top.browsitag,{assignPredictions:this.publisherSelfService.bind(this)});var t=window.top.browsitag;if(window.top.googletag=window.top.googletag||{},window.top.googletag.cmd=window.top.googletag.cmd||[],this.listenToGpt(),this.listenToSlotRequested(),this.listenToSlotRenderEnded(),this.listenToNewSlots(),this.listenToBrowsiAds(),this.papResponse.ptw){var e=this.buildWindowGlobalObject();window.top[this.predictionWindowObjectName]=e,(t.hasOwnProperty(this.predictionKey)||"function"==typeof t[this.predictionKey])&&t[this.predictionKey](e)}},PapAgent.prototype.listenToGpt=function(){var t=this;window.top.googletag.cmd.push(function(){t.logger.verbose("gpt on page")})},PapAgent.prototype.listenToBrowsiAds=function(){var t=this;window.top.addEventListener("ban",function(e){e.detail&&t.browsiAds.push(e.detail)},!1),window.top.addEventListener("bar",function(e){var o=e.detail;if(o){var i=t.browsiAds.indexOf(o);i>-1&&t.browsiAds.splice(i,1)}},!1)},PapAgent.prototype.buildWindowGlobalObject=function(){return{adUnitPredictions:this.buildAdUnitToPredictionObject(this.papResponse.pl),placementPredictions:this.buildPlacementToPredictionObject(this.papResponse.pl)}},PapAgent.prototype.buildPlacementToPredictionObject=function(t){var e=this,o=Object.keys(t).reduce(function(o,i){return o.concat((n={},n[i]=e.getGlobalObjectPrediction(t[i]),n));var n},[]);return Object.assign.apply(Object,[{}].concat(o))},PapAgent.prototype.getGlobalObjectPrediction=function(t){var e=this.getDFPPrediction(t);return e!==this.NA?parseFloat(e):e},PapAgent.prototype.buildAdUnitToPredictionObject=function(t){var e=this,o=Object.keys(t).reduce(function(o,i){var n=t[i],r=n.w.map(function(o){return n={},n[o]=e.getGlobalObjectPrediction(t[i]),n;var n});return o.concat(r)},[]);return Object.assign.apply(Object,[{}].concat(o))},PapAgent.prototype.getDFPPrediction=function(t){if(t){var e=this.getFlooredPrediction(t);return e>=0?e.toFixed(2):this.NA}return this.NA},PapAgent.prototype.getFlooredPrediction=function(t){return t?Math.floor(10*t.p)/10:-1},PapAgent.prototype.publisherSelfService=function(t){if(t){if(this.logger.verbose("publisher requested prediction manually for placement "+t),this.isApiReady()){var e=this.getNewSlots().find(function(e){return e.getSlotElementId()===t});e&&this.setKeyValues([e])}}else this.logger.verbose("publisher requested prediction manually for all slots"),this.assignKeyValueToNewSlots()},PapAgent.prototype.listenToNewSlots=function(){var t=this,e=null,o=setInterval(function(){t.assignKeyValueToNewSlots()},0),i=setInterval(function(){window.top.document.body&&t.isApiReady()&&window.top.googletag.pubads().getSlots().length>0&&(t.logger.verbose("slots found, stopped listening to new slots"),clearInterval(i),clearInterval(o),t.assignKeyValueToNewSlots(),t.slotsLimitReached()?clearTimeout(n):(t.logger.verbose("not all slots found, listening to new slots again"),e=setInterval(function(){t.slotsLimitReached()&&clearInterval(e),t.assignKeyValueToNewSlots()},1e3)))},0),n=setTimeout(function(){clearInterval(i),clearInterval(o),clearInterval(e),t.logger.verbose("stop listening to slots on timeout")},6e4)},PapAgent.prototype.slotsLimitReached=function(){return window.top.googletag.pubads().getSlots().length>=Object.keys(this.papResponse.pl).length},PapAgent.prototype.assignKeyValueToNewSlots=function(){var t=this.getNewSlots();t.length&&this.setKeyValues(t)},PapAgent.prototype.setKeyValues=function(t){var e=this;t.forEach(function(t){if(e.isNewFoundSlot(t)){if(e.pushNewFoundSlot(t),t.getTargeting(e.predictionKey)[0])return;var o=t.getSlotElementId(),i=e.papResponse.pl[e.getPlacementId(t)],n=t.getAdUnitPath(),r=e.getDFPPrediction(i);!e.papResponse.am&&e.isToPush(i,n)?(t.setTargeting(e.predictionKey,r),e.injectedSlots.push(t),e.logger.info("added key value "+e.predictionKey+": "+r+", to placement "+o,document.getElementById(o))):e.logger.info("not assigning key value, placementPrediction:",i)}})},PapAgent.prototype.isToPush=function(t,e){return!t||t.w.includes(e)},PapAgent.prototype.pushNewFoundSlot=function(t){this.foundSlots.push({slot:t,fetchCount:null})},PapAgent.prototype.getNewSlots=function(){var t=this;return this.isApiReady()?window.top.googletag.pubads().getSlots().filter(function(e){return t.isNewFoundSlot(e)&&!t.isBrowsiAd(e.getSlotElementId())}):[]},PapAgent.prototype.isNewFoundSlot=function(t){return!this.foundSlots.find(function(e){return e.slot===t})},PapAgent.prototype.isApiReady=function(){return window.top.googletag&&window.top.googletag.apiReady},PapAgent.prototype.listenToSlotRenderEnded=function(){var t=this;this.listeningToSlotRenderEnded||(window.top.googletag.cmd.push(function(){window.top.googletag.pubads().addEventListener("slotRenderEnded",function(e){if(window.browsi_bootstrap_loaded==t.bootstrapLoadedVariable){var o=e.slot.getAdUnitPath(),i=e.slot.getSlotElementId();if(!t.isBrowsiAd(i)){var n=e.slot.getTargeting(t.predictionKey)[0]||null,r=e.isEmpty,s=t.getAdSize(e);if(t.isNewFoundSlot(e.slot)&&(t.pushNewFoundSlot(e.slot),t.incrementRefreshCount(e.slot)),!r){var a=t.injectedSlots.find(function(t){return t===e.slot});a?t.papResponse.em&&Moat_1.Moat.get().injectMoat(a.getSlotElementId(),t.staticData.sk):t.logger.info("slot "+i+" was not injected on slotRenderEnded")}Events_1.Events.get().sendPapMatchedEvent(t.getPlacementId(e.slot),o,!r,s,n,t.startTime,t.getRefreshCount(e.slot),t.papResponse.pv)}}}),t.logger.info("listening to pap_matched")}),this.listeningToSlotRenderEnded=!0)},PapAgent.prototype.getRefreshCount=function(t){var e=this.foundSlots.find(function(e){return e.slot===t});return e?null!=e.fetchCount?e.fetchCount:(e.fetchCount=0,0):0},PapAgent.prototype.incrementRefreshCount=function(t){var e=this.foundSlots.find(function(e){return e.slot===t});e&&(null===e.fetchCount?e.fetchCount=0:e.fetchCount++)},PapAgent.prototype.listenToSlotRequested=function(){var t=this;this.listeningToSlotRequested||(window.top.googletag.cmd.push(function(){window.top.googletag.pubads().addEventListener("slotRequested",function(e){if(window.browsi_bootstrap_loaded==t.bootstrapLoadedVariable){var o=t.getPlacementId(e.slot);if(!t.isBrowsiAd(e.slot.getSlotElementId())){var i=e.slot.getAdUnitPath(),n=t.papResponse.pl[t.getPlacementId(e.slot)],r=t.isBlackListed(n,i),s=t.injectedSlots.find(function(t){return t===e.slot}),a=t.getInjectedPrediction(e.slot);t.isNewFoundSlot(e.slot)&&t.pushNewFoundSlot(e.slot),t.incrementRefreshCount(e.slot),t.logger.info("slot "+e.slot.getSlotElementId()+" was "+(s?"":"NOT")+" injected on slotRequested with prediction "+a),Events_1.Events.get().sendPapRequestEvent(o,i,t.getRefreshCount(e.slot),a,null!=s&&null!=a,r,n?n.p:-1,t.getRequestedSizes(e),t.startTime,t.papResponse.pv)}}}),t.logger.info("listening to pap_request")}),this.listeningToSlotRequested=!0)},PapAgent.prototype.getRequestedSizes=function(t){var e="";try{e=this.buildSizesFromArray(t.slot.getSizes())}catch(t){}return e},PapAgent.prototype.getInjectedPrediction=function(t){return t.getTargeting(this.predictionKey)[0]||null},PapAgent.prototype.isBlackListed=function(t,e){return!(!t||!t.b)&&t.b.includes(e)},PapAgent.prototype.buildSizesFromArray=function(t){var e="[";return t.forEach(function(t){"object"==typeof t?t.l&&t.j&&(e+=t.l+"X"+t.j+";"):"fluid"==t&&(e+=t+";")}),e+="]"},PapAgent.prototype.getAdSize=function(t){return t&&Array.isArray(t.size)?{w:t.size[0],h:t.size[1]}:{w:-1,h:-1}},PapAgent.prototype.isBrowsiAd=function(t){var e=document.getElementById(t);return!!e&&this.browsiAds.some(function(t){return Utils_1.default.isPositionContained(t,e)})},PapAgent.prototype.getPlacementId=function(slot){var macro=this.papResponse.plidm;if(macro)try{var macroResult=eval(macro.replace(/<DIV_ID>/g,""+slot.getSlotElementId()).replace(/<AD_UNIT>/g,""+slot.getAdUnitPath()).replace(/<KEY_(\w+)>/g,function(t,e){return e&&slot.getTargeting(e).join("_")||"NA"}));return this.logger.verbose("macro result: "+macro+" => "+macroResult),macroResult}catch(t){this.logger.error("failed to evaluate: "+macro)}return slot.getSlotElementId()},PapAgent}();exports.PapAgent=PapAgent},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){t.IHead="iframe.head",t.IBody="iframe.body",t.Head="head",t.Body="body",t.NA="NA"}(e.DomPosition||(e.DomPosition={}))},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(1),n=o(0),r=function(){function t(){this.SCRIPT_SRC="//z.moatads.com/browsidisplay14489870757/moatad.js",this.logger=new i.Logger("Moat")}return t.get=function(){return t._instance||(this._instance=new t),t._instance},t.prototype.injectMoat=function(t,e){var o=document.getElementById(t);if(o){this.logger.info("injecting moat for placement "+t,o);var i=document.createElement("script");i.async=!0,i.setAttribute("src",this.generateMoatUrl("dfp",e,-1,-1)),o.appendChild(i)}else this.logger.error("failed to inject moat for placement "+t)},t.prototype.generateMoatUrl=function(t,e,o,i){var r={moatClientLevel1:t,moatClientLevel2:e,moatClientLevel3:o,moatClientLevel4:i};return this.SCRIPT_SRC+"#"+n.default.toUrlParams(r)},t}();e.Moat=r},function(t,e){Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),o=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=[],n=arguments.length>=2?arguments[1]:void 0,r=0;r<o;r++)if(r in e){var s=e[r];t.call(n,s,r,e)&&i.push(s)}return i}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),o=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var i=arguments[1],n=0;n<o;){var r=e[n];if(t.call(i,r,n,e))return r;n++}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(o[r]=n[r])}return o},writable:!0,configurable:!0}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),i=o.length>>>0;if(0===i)return!1;for(var n=0|e,r=Math.max(n>=0?n:i-Math.abs(n),0);r<i;){if(function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}(o[r],t))return!0;r++}return!1}})}])}]);