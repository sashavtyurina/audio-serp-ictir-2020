define(['module.base','videos_events_plugin'],function(Module,videos_events_plugin){Module.Video_Player=function(){var self=this;self.tpl_main='video_player_embed';self.tpl=window.templates;self.init=function(elm){var data={},opts={},datap=document.getElementById("video_player").getAttribute("data-player-param");if(window._config){opts=self.parseData(datap);if(opts===false){return;}
self.getCustParams(function(){self.renderPlayer(opts);});}};var numRetry=5;var timeOut=function(check,onTimeout){if(numRetry>=0){setTimeout(function(){check(onTimeout);numRetry--;},1000);}else{onTimeout();}};self.getCustParams=function(onDone){var sadvars=getSadvars();if(sadvars){onDone();}
else{timeOut(self.getCustParams,onDone);}};var getSadvars=function(){if(typeof window.sadvars!=="undefined"){return window.sadvars;}};self.renderPlayer=function(opts){if(opts.playerId){opts.adParams=window.sadvars;opts.adParams+=self.compileAdParams(opts);self.element(document.getElementById('video_player_embed'));self.render(opts);self.setupPlayer(opts);}};self.compileAdParams=function(opts){var compileparams='';if(typeof window._user_tracking.can_be_tracked()!=="undefined"&&window._user_tracking.can_be_tracked()){if(typeof opts.videoCategory!=="undefined"){compileparams+="videocat="+opts.videoCategory+"%26";}
if(typeof opts.videoId!=="undefined"){compileparams+="videoid="+opts.videoId;}}
return compileparams;};self.parseData=function(datap){try{return JSON.parse(datap);}catch(e){return false;}}
self.setupPlayer=function(opt){var options=self.getPlayerData(opt);bc(document.getElementById(options.videoDivId));var vp=videojs(options.videoDivId);vp.pelmEvents(options);};self.getPlayerData=function(opt){return{"videoDivId":opt.videoDivId,"videoId":opt.videoId,"playlistId":opt.playlistId,"autoplay":(typeof opt.autoplay!='undefined')?opt.autoplay:'',"adProduct":opt.adCategory,"adParams":opt.adParams,"adRequestMode":opt.adRequestMode,"thumbnailPosition":opt.position.thumbnail,"metadataDisplay":{"name":opt.position.name,"shortDescription":opt.position.shortDescription,"longDescription":opt.position.longDescription}};};};return Module.factory('Video_Player');});;